# TileMap 

## Creat

Creat -> 2D object -> Tilemap -> Rectangle 

## Layer

![image-20241013103837544](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013103837544.png)

## Add component

![image-20241013101532878](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013101532878.png)

- Tilemap Collider 2D

  ![image-20241013101651791](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013101651791.png)

- Rigidbody 2D

  ![image-20241013101811746](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013101811746.png)

- Composite Collider 2D

## Palette 

### Edit

Find the Asserts-> Terrian, and adjust the size (100->16, Pixels Per Unit), use Sprite Editor to edit it.

![image-20241013103048679](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013103048679.png)



### Add Tile Palette 

windows-> 2D -> Tile Palette   -> Create New Palette

![image-20241013103407176](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013103407176.png)

Import: **Drag** the Terrian asserts to the Palette 

# Background

A new tilemap the Copyies TileMap and we¡¯ll rename it as ¡®background¡¯.

In addition, we won¡¯t add component to  it.

## Layer

The layer of it should be the minium.

![image-20241013104208707](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013104208707.png)

## Palette 

Just as the TileMap, we should adjust the size of assert. 

![image-20241013104446468](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013104446468.png)

![image-20241013104612900](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013104612900.png)

Import: **Drag** the Terrian asserts to the Palette 

# Player

![image-20241013104805918](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013104805918.png)

## Creat

Creat -> 2D object -> Sprites -> Rectangle¡­

## Add  Component

![image-20241013105021563](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013105021563.png)

- Rigidbody 2D

![image-20241013105115075](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013105115075.png)

- Box Collider 2D or other ¡­ Capsule ¡­

  Use this button to edit the box.

![image-20241013105256848](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013105256848.png)

## Add Script

### Creat -> C# Script  -> name

![image-20241013105427459](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013105427459.png)



### Add a PlayerMovement component 

PlayerMovement.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEditor.UIElements;
using UnityEngine;

public class PlayerMovement : MonoBehaviour
{
    //public -> we can edit it in inspector
    private Animator anime;
    private Rigidbody2D rb;
    //[SerializeField] -> we can edit the var in inspector but it is private
    [SerializeField] private float movespeed;
    [SerializeField] private float jumpforce;
    [SerializeField] private bool isMoving;
    private LayerMask ground;
    private float xInput;
    private bool isGrounded;

    void Start()
    {
        //initalizaion 
        rb = GetComponent<Rigidbody2D>();
        anime = GetComponentInChildren<Animator>();
    }

    void Update()
    {
        move();
        isMoving= rb.velocity.x!= 0;
        anime.SetBool("IsMoving", isMoving);
    }
    void move()
    {
        //left/right movement 
        xInput = Input.GetAxis("Horizontal");
        //new a Vector2 to edit rb.velocity 
        rb.velocity = new Vector2(xInput * movespeed, rb.velocity.y);
		
        //jump 
        if (Input.GetButtonDown("Jump"))
        {
            //Debug.Log("Jump");
            isGrounded = Physics2D.OverlapCircle(transform.position, 0.2f, ground);
            if (true)//
            {
                jump();
            }
        }
    }
    void jump()
    {
        isGrounded = false;
        rb.velocity = new Vector2(rb.velocity.x, jumpforce);
    }
}

```

Then we should add it to Player as a component 

![image-20241013110436217](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013110436217.png)



## ==Animation==

### 1.Creat

Creat an Empty object under the Player  and name it as Animator.

![image-20241013110806385](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013110806385.png)

Then we should delete the Player Sprites Renderer and add it to Animator

![image-20241013110957710](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013110957710.png)

![image-20241013111009970](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013111009970.png)

And you can edit the Sprite from all your asserts 

![image-20241013111103059](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013111103059.png)

### 2.Window

window->Animation -> Animation

![image-20241013111611791](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013111611791.png)

window->Animation -> Animator

![image-20241013111710411](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013111710411.png)

### 3.Creat  Controller /Anim 

creat -> Animation Controller 

![image-20241013111921764](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013111921764.png)

Import: Drag it to Animator

![image-20241013112042844](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013112042844.png)



Creat anim  (click Animator)

![image-20241013112444674](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013112444674.png)

![image-20241013112223376](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013112223376.png)

if you have already a anim, creat new clips

![image-20241013112412084](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013112412084.png)

then we can add animation frames to .anim(Shift+click, drag them to the linebox ), and adjust the **Samples** to balance the speed

![image-20241013112731373](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013112731373.png)

### 4.Transition

As you can see, we have different animation, but how can we use them? 

![image-20241013113134701](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013113134701.png)

**==Set Parameters==**:

![image-20241013113418500](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013113418500.png)

Right-clik the object module and make transition to other modules:

![image-20241013113820291](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013113820291.png)

Inspect the transition, add conditions

![image-20241013114733561](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013114733561.png)

cancel the duration:

![image-20241013115324675](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013115324675.png)



**==Edit Script==:**

```c#
private Animator anime;//
void Start()
{
	//...
    anime = GetComponentInChildren<Animator>();//
}
void Update()
{
    //...
    isMoving= rb.velocity.x!= 0;
    anime.SetBool("IsMoving", isMoving);//assign isMoving to IsMoving 
}
```

## Flip

```c#
private int facingdir = 1;
private bool isFacingRight = true;

private void FlipController()
{
    if( rb.velocity.x *facingdir < 0)
        Flip();
}   
private void Flip()
{
    transform.Rotate(0, 180, 0);
    facingdir *= -1;
    isFacingRight = !isFacingRight;
}
```



## CollisionChecks

```c#
[Header("Collision info")]
[SerializeField] private LayerMask groundLayer;
[SerializeField] private float groundCheckRadius;
private bool isGrounded;

private void CollisionChecks()
{
    isGrounded = Physics2D.Raycast(transform.position, Vector2.down, groundCheckRadius, groundLayer);
}
private void OnDrawGizmos()
{
    Gizmos.DrawLine(transform.position, 
                    new Vector3(transform.position.x, transform.position.y - groundCheckRadius)); 
}
```

Adjust the Radius until the line touches the ground

![image-20241013220053698](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013220053698.png)

![image-20241013220206499](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013220206499.png)

Set the layer of the TileMap as ground and edit the parameters of Player

![image-20241013220419897](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013220419897.png)

![image-20241013220450368](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241013220450368.png)



## Sticky Walls

Creat -> 2D -> Physics 2D material ->Friction ->0

![image-20241015103102028](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103102028.png)

![image-20241015103118781](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103118781.png)

Drag the material to Player Rigidbody material

![image-20241015103041008](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103041008.png)

## ItemCollector & UI Text

Creat-> UI -> Legacy -> Text 

![image-20241015103436379](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103436379.png)

Install a Font from web  

![image-20241015103514491](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103514491.png)

Add Script to Player

![image-20241015103626355](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103626355.png)

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;//**
public class ItemCollector : MonoBehaviour
{
    private int apples = 0;
    [SerializeField] private Text appleText;
    private void OnTriggerEnter2D(Collider2D collision)
    {
        if (collision.gameObject.CompareTag("Apple"))
        {
            apples++;
            appleText.text = "Apples: "+apples;
            Destroy(collision.gameObject);
        }
    }
}
```

Edit the Item Trigger and Tag (**Apple**)

![image-20241015103852125](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015103852125.png)

Adjust the text window position

![image-20241015104137448](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015104137448.png)



## Death & Restart

Creat a Spike Trap just like Apple  and set it Tag as **Trap** 

![image-20241015132321880](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015132321880.png)

Add Script

PlayerDeath.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;//
using UnityEngine.SceneManagement;//
public class PlayerLife : MonoBehaviour
{
    private Animator anime;
    private Rigidbody2D rb;
    [SerializeField] private Text deathText;
    void Start()
    {
        rb = GetComponent<Rigidbody2D>();
        anime = GetComponentInChildren<Animator>();
    }
    private void OnTriggerEnter2D(Collider2D collision)
    {

        if (collision.gameObject.CompareTag("Trap"))
        {
            Death();
        }
    }
    
    private void Death()
    {
        rb.bodyType = RigidbodyType2D.Static;
        deathText.text = "Game Over\nPress R to restart";
        anime.SetTrigger("Death");//
    }
}
```

ReStart.cs

```c#
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.SceneManagement;

public class ReStart : MonoBehaviour
{
   
    private void Restart()
    {
        SceneManager.LoadScene(SceneManager.GetActiveScene().name);
    }
}

```

Apply the Script to Player and Animator

![image-20241015140814982](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015140814982.png)

![image-20241015143000584](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015143000584.png)



Death **Animation**

- Record the key frame by cancel the Sprite Renderer 
- Add event Restart and bind it with Function Restart()

![image-20241015143255128](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015143255128.png)

![image-20241015143430567](C:\Users\86182\AppData\Roaming\Typora\typora-user-images\image-20241015143430567.png)